-- ğŸ† FINAL ANIMATION SCRIPT: Master Bundle Selector with Hybrid Customization (State Fix) ğŸ†
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- =============================================
-- ğŸŒ GLOBAL CONFIGURATION (getgenv) ğŸŒ
-- =============================================

-- **1. à¹‚à¸«à¸¡à¸” Hybrid Custom**
if getgenv().EnableHybridCustom == nil then
    getgenv().EnableHybridCustom = false -- <<-- **à¸•à¸±à¹‰à¸‡à¹€à¸›à¹‡à¸™ true à¹€à¸à¸·à¹ˆà¸­à¹€à¸›à¸´à¸”à¹‚à¸«à¸¡à¸”à¸œà¸ªà¸¡**
end

-- **2. à¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Hybrid (à¹ƒà¸Šà¹‰à¹„à¸”à¹‰à¹€à¸‰à¸à¸²à¸°à¹€à¸¡à¸·à¹ˆà¸­ EnableHybridCustom à¹€à¸›à¹‡à¸™ true)**
if getgenv().HybridSettings == nil then
    getgenv().HybridSettings = {
        idle1  = "Default", -- à¸—à¹ˆà¸²à¸¢à¸·à¸™à¸™à¸´à¹ˆà¸‡ 1
        idle2  = "Default", -- à¸—à¹ˆà¸²à¸¢à¸·à¸™à¸™à¸´à¹ˆà¸‡ 2
        walk   = "Ninja",   -- à¸—à¹ˆà¸²à¹€à¸”à¸´à¸™
        run    = "Robot",   -- à¸—à¹ˆà¸²à¸§à¸´à¹ˆà¸‡
        jump   = "Levitate",-- à¸—à¹ˆà¸²à¸à¸£à¸°à¹‚à¸”à¸”
        fall   = "Hero",    -- à¸—à¹ˆà¸²à¸•à¸
        climb  = "Default", -- à¸—à¹ˆà¸²à¸›à¸µà¸™
        swim   = "Default", -- à¸—à¹ˆà¸²à¸§à¹ˆà¸²à¸¢à¸™à¹‰à¸³
        swimidle = "Default"-- à¸—à¹ˆà¸²à¸¥à¸­à¸¢à¸•à¸±à¸§à¹ƒà¸™à¸™à¹‰à¸³
    }
end

-- **3. à¹‚à¸«à¸¡à¸”à¹€à¸¥à¸·à¸­à¸à¸Šà¸¸à¸”à¹€à¸”à¸µà¸¢à¸§ (à¹ƒà¸Šà¹‰à¹„à¸”à¹‰à¹€à¸‰à¸à¸²à¸°à¹€à¸¡à¸·à¹ˆà¸­ EnableHybridCustom à¹€à¸›à¹‡à¸™ false)**
if getgenv().ChosenBundleName == nil then
    getgenv().ChosenBundleName = "Ninja" -- <<-- **à¸Šà¸·à¹ˆà¸­à¸Šà¸¸à¸”à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™ (à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¹ƒà¸Šà¹‰ Hybrid)**
end

-- =============================================
-- ğŸ“š MASTER ANIMATION DATA ğŸ“š
-- (à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸Šà¸¸à¸”à¸­à¸™à¸´à¹€à¸¡à¸Šà¸±à¹ˆà¸™à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡)
-- =============================================
local MasterBundles = {
    Ninja = {
        idle1 = "rbxassetid://656117400", idle2 = "rbxassetid://656118341", walk  = "rbxassetid://656121766",
        run   = "rbxassetid://656118852", jump  = "rbxassetid://656117878", fall  = "rbxassetid://10921159222",
        climb = "rbxassetid://656114359", swim = "rbxassetid://10921161002", swimidle = "rbxassetid://10922757002"
    },
    Robot = {
        idle1 = "rbxassetid://616088211", idle2 = "rbxassetid://616089559", walk  = "rbxassetid://616095330",
        run   = "rbxassetid://616091570", jump  = "rbxassetid://616090535", fall  = "rbxassetid://616092998",
        climb = "rbxassetid://616086039", swim = "rbxassetid://10921253142", swimidle = "rbxassetid://10921253767"
    },
    Default = {
        idle1 = "rbxassetid://16738333868", idle2 = "rbxassetid://16738334710", walk  = "rbxassetid://16738340646",
        run   = "rbxassetid://16738337225", jump  = "rbxassetid://104325245285198", fall  = "rbxassetid://616003713",
        climb = "rbxassetid://18537363391", swim = "rbxassetid://133308483266208", swimidle = "rbxassetid://109346520324160"
    },
    custom = {
        idle1 = "rbxassetid://92080889861410", idle2 = "rbxassetid://74451233229259", walk  = "rbxassetid://16738340646",
        run   = "rbxassetid://16738337225", jump  = "rbxassetid://104325245285198", fall  = "rbxassetid://616003713",
        climb = "rbxassetid://18537363391", swim = "rbxassetid://133308483266208", swimidle = "rbxassetid://109346520324160"
    },
    Levitate = {
        idle1 = "rbxassetid://616006778", idle2 = "rbxassetid://616008087", walk  = "rbxassetid://616013216",
        run   = "rbxassetid://616010382", jump  = "rbxassetid://616008936", fall  = "rbxassetid://616005863",
        climb = "rbxassetid://616003713", swim = "rbxassetid://10921139478", swimidle = "rbxassetid://10921138209"
    },
    Mage = {
        idle1 = "rbxassetid://707742142", idle2 = "rbxassetid://707855907", walk  = "rbxassetid://707897309",
        run   = "rbxassetid://707861613", jump  = "rbxassetid://707853694", fall  = "rbxassetid://707829716",
        climb = "rbxassetid://707826056", swim = "rbxassetid://10921150788", swimidle = "rbxassetid://10921151661"
    },
    Stylish = {
        idle1 = "rbxassetid://616136790", idle2 = "rbxassetid://616138447", walk  = "rbxassetid://616146177",
        run   = "rbxassetid://616140816", jump  = "rbxassetid://616139451", fall  = "rbxassetid://616134815",
        climb = "rbxassetid://616133594", swim = "rbxassetid://10921281000", swimidle = "rbxassetid://10921281964"
    },
    Hero = {
        idle1 = "rbxassetid://616111295", idle2 = "rbxassetid://616113536", walk  = "rbxassetid://616122287",
        run   = "rbxassetid://616117076", jump  = "rbxassetid://616115533", fall  = "rbxassetid://616108001",
        climb = "rbxassetid://616104706", swim = "rbxassetid://10921295495", swimidle = "rbxassetid://10921297391"
    },
    Toy = {
        idle1 = "rbxassetid://782841498", idle2 = "rbxassetid://782845736", walk  = "rbxassetid://782843345",
        run   = "rbxassetid://782842708", jump  = "rbxassetid://782847020", fall  = "rbxassetid://782846423",
        climb = "rbxassetid://782843869", swim = "rbxassetid://10921309319", swimidle = "rbxassetid://10921310341"
    },
    Astronaut = {
        idle1 = "rbxassetid://891621366", idle2 = "rbxassetid://891633237", walk  = "rbxassetid://891667138",
        run   = "rbxassetid://891636393", jump  = "rbxassetid://891627522", fall  = "rbxassetid://891617961",
        climb = "rbxassetid://891609353", swim = "rbxassetid://10921044000", swimidle = "rbxassetid://10921045006"
    },
    Bubbly = {
        idle1 = "rbxassetid://910004836", idle2 = "rbxassetid://910009958", walk  = "rbxassetid://910034870",
        run   = "rbxassetid://910025107", jump  = "rbxassetid://910016857", fall  = "rbxassetid://910001910",
        climb = "rbxassetid://742636889", swim = "rbxassetid://10921063569", swimidle = "rbxassetid://10922582160"
    },
    Cartoony = {
        idle1 = "rbxassetid://742637544", idle2 = "rbxassetid://742638445", walk  = "rbxassetid://742640026",
        run   = "rbxassetid://742638842", jump  = "rbxassetid://742637942", fall  = "rbxassetid://742637151",
        climb = "rbxassetid://742636889", swim = "rbxassetid://10921079380", swimidle = "rbxassetid://10921081059"
    },
    Elder = {
        idle1 = "rbxassetid://845397899", idle2 = "rbxassetid://845400520", walk  = "rbxassetid://845403856",
        run   = "rbxassetid://845386501", jump  = "rbxassetid://845398858", fall  = "rbxassetid://845396048",
        climb = "rbxassetid://845392038", swim = "rbxassetid://10921108971", swimidle = "rbxassetid://10921110146"
    },
    Ghost = {
        idle1 = "rbxassetid://616006778", idle2 = "rbxassetid://616008087", walk  = "rbxassetid://616013216",
        run   = "rbxassetid://616013216", jump  = "rbxassetid://616008936", fall  = "rbxassetid://616005863",
        climb = "rbxassetid://616156119", swim = "rbxassetid://133308483266208", swimidle = "rbxassetid://109346520324160"
    },
    Knight = {
        idle1 = "rbxassetid://657595757", idle2 = "rbxassetid://657568135", walk  = "rbxassetid://657552124",
        run   = "rbxassetid://657564596", jump  = "rbxassetid://658409194", fall  = "rbxassetid://657600338",
        climb = "rbxassetid://658360781", swim = "rbxassetid://10921125160", swimidle = "rbxassetid://10921125935"
    },
    Vampire = {
        idle1 = "rbxassetid://1083445855", idle2 = "rbxassetid://1083450166", walk  = "rbxassetid://1083473930",
        run   = "rbxassetid://1083462077", jump  = "rbxassetid://1083455352", fall  = "rbxassetid://1083443587",
        climb = "rbxassetid://1083439238", swim = "rbxassetid://10921324408", swimidle = "rbxassetid://10921325443"
    },
    Werewolf = {
        idle1 = "rbxassetid://1083195517", idle2 = "rbxassetid://1083214717", walk  = "rbxassetid://1083178339",
        run   = "rbxassetid://1083216690", jump  = "rbxassetid://1083218792", fall  = "rbxassetid://1083189019",
        climb = "rbxassetid://1083182000", swim = "rbxassetid://10921340419", swimidle = "rbxassetid://10921341319"
    },
    Zombie = {
        idle1 = "rbxassetid://616158929", idle2 = "rbxassetid://616160636", walk  = "rbxassetid://616168032",
        run   = "rbxassetid://616163682", jump  = "rbxassetid://616161997", fall  = "rbxassetid://616157476",
        climb = "rbxassetid://616156119", swim = "rbxassetid://10921352344", swimidle = "rbxassetid://10921353442"
    },
    Bold = {
        idle1 = "rbxassetid://16738333868", idle2 = "rbxassetid://16738334710", walk  = "rbxassetid://16738340646",
        run   = "rbxassetid://16738337225", jump  = "rbxassetid://16738336650", fall  = "rbxassetid://16738333171",
        climb = "rbxassetid://16738332169", swim = "rbxassetid://16738339158", swimidle = "rbxassetid://16738339817"
    },
    Adidas = {
        idle1 = "rbxassetid://18537376492", idle2 = "rbxassetid://18537371272", walk  = "rbxassetid://18537392113",
        run   = "rbxassetid://18537384940", jump  = "rbxassetid://18537380791", fall  = "rbxassetid://18537367238",
        climb = "rbxassetid://18537363391", swim = "rbxassetid://18537389531", swimidle = "rbxassetid://18537387180"
    },
    Catwalk = {
        idle1 = "rbxassetid://133806214992291", idle2 = "rbxassetid://94970088341563", walk  = "rbxassetid://109168724482748",
        run   = "rbxassetid://81024476153754", jump  = "rbxassetid://116936326516985", fall  = "rbxassetid://119377220967554",
        climb = "rbxassetid://92294537340807", swim = "rbxassetid://134591743181628", swimidle = "rbxassetid://98854111361360"
    },
    Walmart = {
        idle1 = "rbxassetid://18747067405", idle2 = "rbxassetid://18747063918", walk  = "rbxassetid://18747074203",
        run   = "rbxassetid://18747070484", jump  = "rbxassetid://18747069148", fall  = "rbxassetid://18747062535",
        climb = "rbxassetid://18747060903", swim = "rbxassetid://18747073181", swimidle = "rbxassetid://18747071682"
    },
    Wicked = {
        idle1 = "rbxassetid://118832222982049", idle2 = "rbxassetid://76049494037641", walk  = "rbxassetid://92072849924640",
        run   = "rbxassetid://72301599441680", jump  = "rbxassetid://104325245285198", fall  = "rbxassetid://121152442762481",
        climb = "rbxassetid://131326830509784", swim = "rbxassetid://99384245425157", swimidle = "rbxassetid://113199415118199"
    },
    NFL = {
        idle1 = "rbxassetid://92080889861410", idle2 = "rbxassetid://74451233229259", walk  = "rbxassetid://110358958299415",
        run   = "rbxassetid://117333533048078", jump  = "rbxassetid://119846112151352", fall  = "rbxassetid://129773241321032",
        climb = "rbxassetid://134630013742019", swim = "rbxassetid://132697394189921", swimidle = "rbxassetid://79090109939093"
    },
    Pirate = {
        idle1 = "rbxassetid://750781874", idle2 = "rbxassetid://750782770", walk  = "rbxassetid://750785693",
        run   = "rbxassetid://750783738", jump  = "rbxassetid://750782230", fall  = "rbxassetid://750780242",
        climb = "rbxassetid://750779899", swim = "rbxassetid://750784579", swimidle = "rbxassetid://750785176"
    },
    Adidas2 = {
        idle1 = "rbxassetid://122257458498464", idle2 = "rbxassetid://102357151005774", walk  = "rbxassetid://122150855457006",
        run   = "rbxassetid://82598234841035", jump  = "rbxassetid://75290611992385", fall  = "rbxassetid://98600215928904",
        climb = "rbxassetid://88763136693023", swim = "rbxassetid://133308483266208", swimidle = "rbxassetid://109346520324160"
    },
    Oldschool = {
        idle1 = "rbxassetid://10921230744", idle2 = "rbxassetid://10921232093", walk  = "rbxassetid://10921244891",
        run   = "rbxassetid://10921240218", jump  = "rbxassetid://10921242013", fall  = "rbxassetid://10921241244",
        climb = "rbxassetid://10921229866", swim = "rbxassetid://10921243048", swimidle = "rbxassetid://10921244018"
    }
}

-- à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™
local IsActive = true 
local CurrentBundleName = getgenv().ChosenBundleName -- à¹ƒà¸Šà¹‰à¸ªà¸³à¸«à¸£à¸±à¸šà¹‚à¸«à¸¡à¸”à¸›à¸à¸•à¸´à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™

-- ===============================================
-- ğŸ›  CORE FUNCTIONS ğŸ› 
-- ===============================================

local function StopAllAnimations(Humanoid)
    if not Humanoid or Humanoid.Parent == nil then return end
    for _, track in pairs(Humanoid:GetPlayingAnimationTracks()) do
        track:Stop()
        track:Destroy()
    end
end

local function GetAnimID(AnimKey)
    local bundleName
    
    -- 1. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹‚à¸«à¸¡à¸” Hybrid Custom
    if getgenv().EnableHybridCustom then
        bundleName = getgenv().HybridSettings[AnimKey]
        if not bundleName or not MasterBundles[bundleName] then
            warn("Hybrid Error: Bundle '"..tostring(bundleName).."' not found for '"..AnimKey.."'. Falling back to Default.")
            bundleName = "Default"
        end
    -- 2. à¹ƒà¸Šà¹‰à¹‚à¸«à¸¡à¸” Bundle à¹€à¸”à¸µà¸¢à¸§
    else
        bundleName = getgenv().ChosenBundleName
        if not bundleName or not MasterBundles[bundleName] then
            warn("Bundle Error: Bundle '"..tostring(bundleName).."' not found. Falling back to Default.")
            bundleName = "Default"
        end
    end
    
    -- à¸”à¸¶à¸‡ Animation ID à¸ˆà¸²à¸à¸Šà¸·à¹ˆà¸­à¸Šà¸¸à¸”à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸
    local id = MasterBundles[bundleName][AnimKey]
    if not id then
        -- à¹ƒà¸™à¸à¸£à¸“à¸µà¸—à¸µà¹ˆà¸Šà¸¸à¸”à¸™à¸±à¹‰à¸™à¹† à¹„à¸¡à¹ˆà¸¡à¸µà¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™à¸ˆà¸£à¸´à¸‡à¹† (à¹„à¸¡à¹ˆà¸„à¸§à¸£à¹€à¸à¸´à¸”à¸‚à¸¶à¹‰à¸™à¸–à¹‰à¸² MasterBundles à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡)
        return MasterBundles["Default"][AnimKey]
    end
    return id
end

local function UpdateAnims(Character)
    -- *** FIX: UpdateAnims à¸ˆà¸°à¸•à¹‰à¸­à¸‡à¸–à¸¹à¸à¹€à¸£à¸µà¸¢à¸à¹€à¸¡à¸·à¹ˆà¸­ IsActive à¹€à¸›à¹‡à¸™ true à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™ à¸¢à¸à¹€à¸§à¹‰à¸™à¸•à¸­à¸™ CharacterAdded à¸‹à¸¶à¹ˆà¸‡à¸–à¸¹à¸à¹à¸à¹‰à¹„à¸‚à¹‚à¸”à¸¢à¸à¸²à¸£à¸šà¸±à¸‡à¸„à¸±à¸š IsActive = true à¹ƒà¸™à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™ Toggle/Switch
    if not IsActive then return end 

    local Humanoid = Character:WaitForChild("Humanoid", 10)
    local AnimateScript = Character:WaitForChild("Animate", 10) 

    if not Humanoid or not AnimateScript then 
        warn("Humanoid or Animate script not found.")
        return 
    end
    
    -- ğŸ”¥ FIX: à¹€à¸à¸´à¹ˆà¸¡à¸„à¸§à¸²à¸¡à¹€à¸ªà¸–à¸µà¸¢à¸£à¹ƒà¸™à¸à¸²à¸£à¹‚à¸«à¸¥à¸”à¸­à¸™à¸´à¹€à¸¡à¸Šà¸±à¹ˆà¸™ (Race Condition Fix) ğŸ”¥
    local walkController = AnimateScript:WaitForChild("walk", 5)
    if not walkController then
        warn("Animate script failed to initialize its child objects within 5 seconds.")
        return
    end
    
    task.wait(0.01) -- à¹ƒà¸«à¹‰à¹€à¸§à¸¥à¸²à¸ªà¸±à¹‰à¸™à¹† à¸«à¸¥à¸±à¸‡à¸ˆà¸²à¸à¸—à¸µà¹ˆ Child Object à¸–à¸¹à¸à¸ªà¸£à¹‰à¸²à¸‡
    
    -- à¸­à¸±à¸›à¹€à¸”à¸•à¸Šà¸·à¹ˆà¸­à¸Šà¸¸à¸”à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™à¸ªà¸³à¸«à¸£à¸±à¸šà¹‚à¸«à¸¡à¸”à¸›à¸à¸•à¸´
    CurrentBundleName = getgenv().ChosenBundleName
    
    StopAllAnimations(Humanoid)
    
    local function changeID(parentName, newID)
        local parentValue = AnimateScript:FindFirstChild(parentName)
        if parentValue then
            for _, child in pairs(parentValue:GetChildren()) do
                if child:IsA("Animation") then
                    child.AnimationId = newID
                end
            end
        end
    end

    -- à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸—à¹ˆà¸²à¸—à¸²à¸‡à¸«à¸¥à¸±à¸à¹‚à¸”à¸¢à¹ƒà¸Šà¹‰ GetAnimID à¹€à¸à¸·à¹ˆà¸­à¸ˆà¸±à¸”à¸à¸²à¸£ Hybrid/Single
    changeID("walk", GetAnimID("walk"))
    changeID("run", GetAnimID("run"))
    changeID("jump", GetAnimID("jump"))
    changeID("fall", GetAnimID("fall"))
    changeID("climb", GetAnimID("climb"))
    changeID("swim", GetAnimID("swim"))
    changeID("swimidle", GetAnimID("swimidle"))

    -- à¸ˆà¸±à¸”à¸à¸²à¸£à¸—à¹ˆà¸² Idle
    local idleValue = AnimateScript:FindFirstChild("idle")
    if idleValue then
        local idleMapping = {GetAnimID("idle1"), GetAnimID("idle2")}
        for i, animId in ipairs(idleMapping) do
            local animObject = idleValue:FindFirstChild("Animation"..i) 
            if animObject and animObject:IsA("Animation") then
                animObject.AnimationId = animId
            end
        end
    end
    
    -- à¸šà¸±à¸‡à¸„à¸±à¸šà¹ƒà¸«à¹‰à¸ªà¸„à¸£à¸´à¸›à¸•à¹Œ Animate à¹‚à¸«à¸¥à¸” Animation ID à¹ƒà¸«à¸¡à¹ˆ
    AnimateScript.Disabled = true
    task.wait() 
    AnimateScript.Disabled = false
    
    if getgenv().EnableHybridCustom then
        print("âœ… Animations set to: HYBRID CUSTOM MODE")
    else
        print("âœ… Animations set to: "..CurrentBundleName.." (SINGLE MODE)")
    end
end

-- ===============================================
-- ğŸ’» EXECUTION AND CHAT LISTENER ğŸ’»
-- ===============================================

-- à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ªà¸³à¸«à¸£à¸±à¸šà¸ªà¸¥à¸±à¸šà¹‚à¸«à¸¡à¸” Hybrid
getgenv().ToggleHybridMode = function(enabled)
    local state = enabled == true
    
    -- *** FIX: à¸«à¸²à¸à¸¡à¸µà¸à¸²à¸£à¹€à¸£à¸µà¸¢à¸à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸™à¸µà¹‰ à¸•à¹‰à¸­à¸‡à¸¡à¸±à¹ˆà¸™à¹ƒà¸ˆà¸§à¹ˆà¸²à¸ªà¸–à¸²à¸™à¸° Active à¸–à¸¹à¸à¸•à¸±à¹‰à¸‡à¹€à¸›à¹‡à¸™ true
    IsActive = true

    if getgenv().EnableHybridCustom ~= state then
        getgenv().EnableHybridCustom = state
        print("ğŸ”„ Hybrid Custom Mode is now: "..(state and "**ENABLED**" or "**DISABLED**"))
        if LocalPlayer.Character then
            UpdateAnims(LocalPlayer.Character)
        end
    else
        -- à¸–à¹‰à¸²à¸ªà¸–à¸²à¸™à¸°à¹„à¸¡à¹ˆà¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ à¹à¸•à¹ˆà¹€à¸£à¸µà¸¢à¸ UpdateAnims à¸‹à¹‰à¸³à¹€à¸à¸·à¹ˆà¸­à¹‚à¸«à¸¥à¸”à¸­à¸™à¸´à¹€à¸¡à¸Šà¸±à¹ˆà¸™ (à¸à¸£à¸“à¸µà¸—à¸µà¹ˆà¹€à¸„à¸¢à¸–à¸¹à¸ /e stop)
        if LocalPlayer.Character then
            UpdateAnims(LocalPlayer.Character)
        end
        print("â— Hybrid Custom Mode is already: "..(state and "ENABLED" or "DISABLED"))
    end
end

-- à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ªà¸³à¸«à¸£à¸±à¸šà¸ªà¸¥à¸±à¸šà¹‚à¸«à¸¡à¸” Single Bundle
getgenv().SwitchAnimationBundle = function(bundleName)
    local lowerName = bundleName:lower()
    if MasterBundles[lowerName] then
        
        -- *** FIX: à¸«à¸²à¸à¸¡à¸µà¸à¸²à¸£à¹€à¸£à¸µà¸¢à¸à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸™à¸µà¹‰ à¸•à¹‰à¸­à¸‡à¸¡à¸±à¹ˆà¸™à¹ƒà¸ˆà¸§à¹ˆà¸²à¸ªà¸–à¸²à¸™à¸° Active à¸–à¸¹à¸à¸•à¸±à¹‰à¸‡à¹€à¸›à¹‡à¸™ true
        IsActive = true
        
        -- à¸ªà¸¥à¸±à¸šà¹„à¸›à¹‚à¸«à¸¡à¸” Single à¹‚à¸”à¸¢à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
        if getgenv().EnableHybridCustom then
            getgenv().ToggleHybridMode(false)
        end
        
        -- à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸•à¹‰à¸­à¸‡à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸Šà¸¸à¸”à¸ˆà¸£à¸´à¸‡à¹† à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ (à¹à¸¥à¸°à¹‚à¸«à¸¥à¸”à¸‹à¹‰à¸³à¸–à¹‰à¸² IsActive à¸–à¸¹à¸à¸›à¸´à¸”à¸à¹ˆà¸­à¸™à¸«à¸™à¹‰à¸²à¸™à¸µà¹‰)
        if lowerName ~= getgenv().ChosenBundleName then
            print("ğŸ”„ Switching bundle to: "..lowerName.." (via getgenv().SwitchAnimationBundle)")
            getgenv().ChosenBundleName = lowerName
            if LocalPlayer.Character then
                UpdateAnims(LocalPlayer.Character)
            end
        else
            -- à¸«à¸²à¸à¸Šà¸·à¹ˆà¸­à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™ à¹ƒà¸«à¹‰à¹€à¸£à¸µà¸¢à¸ UpdateAnims() à¹€à¸à¸·à¹ˆà¸­à¹‚à¸«à¸¥à¸”à¸‹à¹‰à¸³ à¸à¸£à¸“à¸µà¸—à¸µà¹ˆà¹€à¸à¸´à¹ˆà¸‡à¸­à¸­à¸à¸ˆà¸²à¸ /e stop
            if LocalPlayer.Character then
                UpdateAnims(LocalPlayer.Character)
            end
            print("â— Already using bundle: "..lowerName.." - Reapplied animations.")
        end
    else
        local availableBundles = ""
        for name, _ in pairs(MasterBundles) do
            availableBundles = availableBundles .. name .. ", "
        end
        print("âŒ Error: Bundle '"..bundleName.."' not found. Available: "..availableBundles:sub(1, -3))
    end
end


if LocalPlayer.Character then
    UpdateAnims(LocalPlayer.Character)
end

LocalPlayer.CharacterAdded:Connect(UpdateAnims)

LocalPlayer.Chatted:Connect(function(message)
    local lowerMsg = message:lower()
    local parts = string.split(lowerMsg, " ")

    if parts[1] == "/e" and parts[2] == "stop" then
        -- ğŸ›‘ /e stop: à¸«à¸¢à¸¸à¸”à¸–à¸²à¸§à¸£
        if IsActive then
            IsActive = false
            if LocalPlayer.Character and LocalPlayer.Character.Humanoid then
                StopAllAnimations(LocalPlayer.Character.Humanoid)
                local AnimateScript = LocalPlayer.Character:FindFirstChild("Animate")
                if AnimateScript then
                    local STATIC_ANIM_ID = "rbxassetid://0"
                    local function setStaticID(parentName)
                        local parentValue = AnimateScript:FindFirstChild(parentName)
                        if parentValue then
                            for _, child in pairs(parentValue:GetChildren()) do
                                if child:IsA("Animation") then
                                    child.AnimationId = STATIC_ANIM_ID
                                end
                            end
                        end
                    end
                    
                    setStaticID("walk") setStaticID("run") setStaticID("jump") setStaticID("fall") 
                    setStaticID("climb") setStaticID("swim") setStaticID("swimidle")

                    local idleValue = AnimateScript:FindFirstChild("idle")
                    if idleValue then
                        if idleValue:FindFirstChild("Animation1") and idleValue.Animation1:IsA("Animation") then
                            idleValue.Animation1.AnimationId = STATIC_ANIM_ID
                        end
                        if idleValue:FindFirstChild("Animation2") and idleValue.Animation2:IsA("Animation") then
                            idleValue.Animation2.AnimationId = STATIC_ANIM_ID
                        end
                    end
                    AnimateScript.Disabled = true
                    task.wait(0.1) 
                    AnimateScript.Disabled = false
                end
            end
            print("ğŸ›‘ Custom Animations Deactivated. All animations are set to static (zero). Use /e start or /e [BundleName] to reactivate.")
        end
    elseif parts[1] == "/e" and parts[2] == "start" then
        -- ğŸŸ¢ /e start: à¹€à¸›à¸´à¸”à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡
        if not IsActive then
            IsActive = true
            if getgenv().EnableHybridCustom then
                print("ğŸŸ¢ Custom Animations Activated. Loading: HYBRID CUSTOM MODE")
            else
                CurrentBundleName = getgenv().ChosenBundleName
                print("ğŸŸ¢ Custom Animations Activated. Loading bundle: "..CurrentBundleName)
            end
            
            if LocalPlayer.Character then
                UpdateAnims(LocalPlayer.Character)
            end
        end
    elseif parts[1] == "/e" and parts[2] == "custom" then
        -- ğŸ†• /e custom: à¸ªà¸¥à¸±à¸šà¹„à¸› Hybrid à¹à¸¥à¸°à¹€à¸›à¸´à¸”à¹ƒà¸Šà¹‰à¸‡à¸²à¸™
        getgenv().ToggleHybridMode(true)
    elseif parts[1] == "/e" and MasterBundles[parts[2]] then
        -- ğŸ”„ /e [BundleName]: à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸Šà¸¸à¸” (Single) à¹à¸¥à¸°à¹€à¸›à¸´à¸”à¹ƒà¸Šà¹‰à¸‡à¸²à¸™
        getgenv().SwitchAnimationBundle(parts[2])
    elseif parts[1] == "/e" and parts[2] and not MasterBundles[parts[2]] then
        local availableBundles = ""
        for name, _ in pairs(MasterBundles) do
            availableBundles = availableBundles .. name .. ", "
        end
        print("âŒ Error: Bundle '"..parts[2].."' not found. Available: "..availableBundles:sub(1, -3))
    end
end)

local displayMode = getgenv().EnableHybridCustom and "HYBRID CUSTOM" or getgenv().ChosenBundleName .. " (SINGLE)"
print("Script Loaded! Current Mode: "..displayMode..". Use /e [BundleName] to switch or /e custom to enter Hybrid Mode.")
